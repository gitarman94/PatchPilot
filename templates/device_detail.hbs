<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Device Detail — PatchPilot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
  <div id="navbar-container"></div>
  <div class="container">
    <h2>Device Detail</h2>
    <div id="deviceInfo" class="card">
      <div class="card-body">
        <p><strong>Hostname:</strong> <span id="hostname">—</span></p>
        <p><strong>OS:</strong> <span id="os">—</span></p>
        <p><strong>Type:</strong> <span id="type">—</span></p>
        <p><strong>CPU:</strong> <span id="cpu">—</span></p>
        <p><strong>RAM:</strong> <span id="ram">—</span></p>
        <p><strong>Disk:</strong> <span id="disk">—</span></p>
        <p><strong>Network:</strong> <span id="network">—</span></p>
        <p><strong>Last Check-in:</strong> <span id="lastCheckin">—</span></p>
      </div>
    </div>
    <div class="mt-3">
      <button class="btn" id="backBtn">Back</button>
    </div>
  </div>

  <div id="alerts"></div>
  <script src="/static/app.js"></script>
  <script>
    document.getElementById('navbar-container').innerHTML = `<object type="text/html" data="/navbar.html"></object>`;

    const urlParams = new URLSearchParams(window.location.search);
    const deviceID = urlParams.get('deviceID');

    async function loadDevice() {
      if(!deviceID) return;
      try {
        const d = await fetchJSON(`/api/devices/${deviceID}`);
        document.getElementById('hostname').textContent = d.hostname || '—';
        document.getElementById('os').textContent = d.os_name || '—';
        document.getElementById('type').textContent = d.device_type || '—';
        document.getElementById('cpu').textContent = d.cpu_usage != null ? d.cpu_usage+'%' : '—';
        document.getElementById('ram').textContent = d.ram_used != null && d.ram_total ? `${d.ram_used}/${d.ram_total} MB` : '—';
        document.getElementById('disk').textContent = d.disk_total ? `${d.disk_total - d.disk_free}/${d.disk_total} GB` : '—';
        document.getElementById('network').textContent = d.network_throughput ? `${d.network_throughput} Mbps` : '—';
        document.getElementById('lastCheckin').textContent = d.last_checkin ? new Date(d.last_checkin).toLocaleString() : '—';
      } catch(e) {
        showAlert('Failed to load device', 'danger');
        console.error(e);
      }
    }

    document.getElementById('backBtn').addEventListener('click', ()=> window.history.back());

    loadDevice();
  </script>
</body>
</html>
