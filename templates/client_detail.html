<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Device Detail</title>
    <!-- Add your CSS stylesheets here -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container mt-4">
        <!-- Device Information -->
        <h2>Device: <span id="device-name">Loading...</span></h2>
        <p>OS: <span id="os-name">Loading...</span></p>
        <p>Last Check-in: <span id="last-checkin">Loading...</span></p>

        <!-- System Stats -->
        <div class="card mt-4">
            <div class="card-header">System Information</div>
            <div class="card-body">
                <div id="system-info">
                    <!-- Dynamic system data will be displayed here -->
                </div>
            </div>
        </div>

        <!-- CPU Usage Chart -->
        <div class="card mt-4">
            <div class="card-header">CPU Usage</div>
            <div class="card-body">
                <canvas id="cpuUsageChart"></canvas>
            </div>
        </div>

        <!-- RAM Usage Chart -->
        <div class="card mt-4">
            <div class="card-header">RAM Usage</div>
            <div class="card-body">
                <canvas id="ramUsageChart"></canvas>
            </div>
        </div>

        <!-- Disk Usage Chart -->
        <div class="card mt-4">
            <div class="card-header">Disk Usage</div>
            <div class="card-body">
                <canvas id="diskUsageChart"></canvas>
            </div>
        </div>

        <!-- Network Stats -->
        <div class="card mt-4">
            <div class="card-header">Network Throughput</div>
            <div class="card-body">
                <p><strong>Network Throughput:</strong> <span id="network-throughput">Loading...</span> bytes</p>
                <p><strong>Ping Latency:</strong> <span id="ping-latency">Loading...</span> ms</p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const deviceId = window.location.pathname.split('/').pop(); // Get the device ID from the URL
            
            // Fetch device data from the server
            fetch(`/api/devices/${deviceId}`)
                .then(response => response.json())
                .then(data => {
                    const device = data;

                    // Populate device info
                    document.getElementById('device-name').textContent = device.device_name;
                    document.getElementById('os-name').textContent = device.os_name;
                    document.getElementById('last-checkin').textContent = new Date(device.last_checkin).toLocaleString();

                    // Populate system stats
                    document.getElementById('system-info').innerHTML = ` 
                        <p><strong>CPU Usage:</strong> ${device.cpu}%</p>
                        <p><strong>Total RAM:</strong> ${(device.ram_total / 1024 / 1024 / 1024).toFixed(2)} GB</p>
                        <p><strong>Used RAM:</strong> ${(device.ram_used / 1024 / 1024 / 1024).toFixed(2)} GB</p>
                        <p><strong>Free RAM:</strong> ${(device.ram_free / 1024 / 1024 / 1024).toFixed(2)} GB</p>
                        <p><strong>Disk Health:</strong> ${device.disk_health}</p>
                        <p><strong>Total Disk:</strong> ${(device.disk_total / 1024 / 1024 / 1024).toFixed(2)} GB</p>
                        <p><strong>Free Disk:</strong> ${(device.disk_free / 1024 / 1024 / 1024).toFixed(2)} GB</p>
                    `;

                    // Network Stats
                    document.getElementById('network-throughput').textContent = device.network_throughput;
                    document.getElementById('ping-latency').textContent = device.ping_latency;

                    // Initialize CPU, RAM, and Disk usage charts
                    const cpuCtx = document.getElementById('cpuUsageChart').getContext('2d');
                    new Chart(cpuCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['CPU Usage', 'Idle'],
                            datasets: [{
                                data: [device.cpu, 100 - device.cpu],
                                backgroundColor: ['#f56c42', '#42f56c'],
                                borderColor: '#ffffff',
                                borderWidth: 1
                            }]
                        }
                    });

                    const ramCtx = document.getElementById('ramUsageChart').getContext('2d');
                    new Chart(ramCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Used RAM', 'Free RAM'],
                            datasets: [{
                                data: [device.ram_used, device.ram_free],
                                backgroundColor: ['#f56c42', '#42f56c'],
                                borderColor: '#ffffff',
                                borderWidth: 1
                            }]
                        }
                    });

                    const diskCtx = document.getElementById('diskUsageChart').getContext('2d');
                    new Chart(diskCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Used Disk', 'Free Disk'],
                            datasets: [{
                                data: [device.disk_total - device.disk_free, device.disk_free],
                                backgroundColor: ['#f56c42', '#42f56c'],
                                borderColor: '#ffffff',
                                borderWidth: 1
                            }]
                        }
                    });
                })
                .catch(error => console.error('Error fetching device data:', error));
        });
    </script>
</body>
</html>
