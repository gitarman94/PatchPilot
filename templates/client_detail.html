<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Client Details - PatchPilot</title>

    <!-- Bootstrap 5 -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
          crossorigin="anonymous">

    <!-- Font Awesome -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
          crossorigin="anonymous"/>
    
    <style>
        .status-online { color:#28a745; font-weight:bold; }
        .status-offline { color:#dc3545; font-weight:bold; }
        .card-header { background-color: #f8f9fa; }
        .metric-value { font-size: 1.25rem; font-weight: bold; }
        .metric-label { font-size: 0.875rem; color: #6c757d; }
        .action-buttons .btn { margin-right: 10px; }
        .spinner-container { text-align: center; margin-top: 20px; }
        .badge-status { padding: 5px 10px; font-size: 0.875rem; }
    </style>
</head>
<body>
<div class="container py-4">

    <h2 class="mb-4">Client Details</h2>

    <!-- Status & Basic Info -->
    <div class="row mb-4">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span><strong>{{ client.client_name or '‚Äî' }}</strong></span>
                    <span id="status">
                        {% if client.online %}
                            <span class="status-online">üü¢ Online</span>
                        {% else %}
                            <span class="status-offline">üî¥ Offline</span>
                        {% endif %}
                    </span>
                </div>
                <div class="card-body">
                    <p><strong>Hostname:</strong> {{ client.client_name }}</p>
                    <p><strong>OS:</strong> {{ client.os_name }}</p>
                    <p><strong>CPU:</strong> {{ client.cpu }}</p>
                    <p><strong>RAM:</strong> {{ client.ram }} GB</p>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card">
                <div class="card-header">Actions</div>
                <div class="card-body action-buttons">
                    <button id="approve-client" class="btn btn-success">
                        <i class="fa-solid fa-check"></i> Approve Client
                    </button>
                    <button class="btn btn-outline-primary">
                        <i class="fa-solid fa-rotate"></i> Force Patch
                    </button>
                    <button class="btn btn-outline-danger">
                        <i class="fa-solid fa-arrow-rotate-left"></i> Force Reinstall
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Metrics & Performance -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">System Performance</div>
                <div class="card-body">
                    <p><strong>Disk Usage:</strong> <span class="metric-value">{{ client.disk_total }} GB / {{ client.disk_free }} GB</span></p>
                    <p class="metric-label">Disk Health: 
                        <span class="badge {{ 'badge-success' if client.disk_health == 'Healthy' else 'badge-danger' }}">
                            {{ client.disk_health }}
                        </span>
                    </p>
                    <p><strong>Uptime:</strong> <span class="metric-value">{{ client.uptime }}</span></p>
                    <div class="d-flex justify-content-between">
                        <p><strong>Network Throughput:</strong> <span class="metric-value">{{ client.network_throughput }} Mbps</span></p>
                        <p><strong>Ping Latency:</strong> <span class="metric-value">{{ client.ping_latency }} ms</span></p>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card">
                <div class="card-header">Updates & Notifications</div>
                <div class="card-body">
                    <p><strong>Updates Available:</strong>
                        {% if client.updates_available %}
                            <span class="badge badge-warning">‚ö†Ô∏è Yes</span>
                        {% else %}
                            <span class="badge badge-success">‚úÖ No</span>
                        {% endif %}
                    </p>
                    <p><strong>Last Check-in:</strong> {{ client.last_checkin }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading state -->
    <div class="spinner-container" id="loadingState">
        <div class="spinner-border" role="status"></div>
        <p>Loading data...</p>
    </div>

</div>

<script src="https://code.jquery.com/jquery-3.7.0.min.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

<script>
    $(document).ready(function () {
        // Periodic refresh of client status every 30 seconds
        setInterval(function() {
            $.get(`/api/clients/{{ client.id }}/status`, function(data) {
                // Update client status
                if (data.client.online) {
                    $('#status').html('<span class="status-online">üü¢ Online</span>');
                } else {
                    $('#status').html('<span class="status-offline">üî¥ Offline</span>');
                }
            });
        }, 30000); // Refresh every 30 seconds

        // Approve client
        $('#approve-client').click(function() {
            $.post('/approve/{{ client.id }}', function(response) {
                alert("Client approved successfully!");
            });
        });

        // Hide loading spinner when data is loaded
        $('#loadingState').hide();
    });
</script>

</body>
</html>
