<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Device Details - PatchPilot</title>
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">

    <!-- Bootstrap 5 -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
          crossorigin="anonymous">

    <!-- Font Awesome -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
          crossorigin="anonymous"/>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            background-color: #f4f6f8;
        }
        .card-header {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        .status-online { color: #28a745; font-weight: bold; }
        .status-offline { color: #dc3545; font-weight: bold; }
        .metric-value { font-size: 1.2rem; font-weight: 600; }
        .metric-label { font-size: 0.875rem; color: #6c757d; }
        .action-buttons .btn { margin-right: 10px; }
        .badge-status { padding: 5px 10px; font-size: 0.875rem; }
    </style>
</head>

<body>
<div class="container py-4">
    <h2 class="mb-4"><i class="fa-solid fa-desktop"></i> Device Details</h2>

    <div class="row">
        <!-- LEFT COLUMN -->
        <div class="col-md-6">
            <!-- Device Info -->
            <div class="card mb-4">
                <div class="card-header"><i class="fa-solid fa-circle-info"></i> Device Information</div>
                <div class="card-body">
                    <p><strong>Name:</strong> <span id="device-name">Loading...</span></p>
                    <p><strong>OS:</strong> <span id="os-name">Loading...</span></p>
                    <p><strong>Last Check-in:</strong> <span id="last-checkin">Loading...</span></p>
                    <p><strong>Status:</strong> <span id="status">Loading...</span></p>
                </div>
            </div>

            <!-- System Info -->
            <div class="card mb-4">
                <div class="card-header"><i class="fa-solid fa-microchip"></i> System Information</div>
                <div class="card-body" id="system-info">
                    <p>Loading system details...</p>
                </div>
            </div>

            <!-- Wi-Fi Info -->
            <div class="card mb-4">
                <div class="card-header"><i class="fa-solid fa-wifi"></i> Wi-Fi Information</div>
                <div class="card-body" id="wifi-info">
                    <p><strong>SSID:</strong> <span id="wifi-ssid">Loading...</span></p>
                    <p><strong>Signal Strength:</strong> <span id="wifi-signal">Loading...</span></p>
                    <p><strong>Nearby Networks:</strong></p>
                    <ul id="wifi-networks" class="list-group list-group-flush"></ul>
                </div>
            </div>

            <!-- Patch Info -->
            <div class="card mb-4">
                <div class="card-header"><i class="fa-solid fa-shield-halved"></i> Patch Information</div>
                <div class="card-body">
                    <p><strong>Status:</strong> <span id="patch-status">Loading...</span></p>
                    <p><strong>Last Patch Date:</strong> <span id="last-patch-date">Loading...</span></p>
                </div>
            </div>
        </div>

        <!-- RIGHT COLUMN -->
        <div class="col-md-6">
            <!-- Charts -->
            <div class="card mb-4">
                <div class="card-header"><i class="fa-solid fa-chart-pie"></i> CPU Usage</div>
                <div class="card-body">
                    <canvas id="cpuUsageChart" height="150"></canvas>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header"><i class="fa-solid fa-memory"></i> RAM Usage</div>
                <div class="card-body">
                    <canvas id="ramUsageChart" height="150"></canvas>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header"><i class="fa-solid fa-hard-drive"></i> Disk Usage</div>
                <div class="card-body">
                    <canvas id="diskUsageChart" height="150"></canvas>
                </div>
            </div>

            <!-- Network Stats -->
            <div class="card mb-4">
                <div class="card-header"><i class="fa-solid fa-network-wired"></i> Network Stats</div>
                <div class="card-body">
                    <p><strong>Network Throughput:</strong> <span id="network-throughput">Loading...</span> Mbps</p>
                    <p><strong>Ping Latency:</strong> <span id="ping-latency">Loading...</span> ms</p>
                </div>
            </div>

            <!-- Actions -->
            <div class="card mb-4">
                <div class="card-header"><i class="fa-solid fa-gears"></i> Actions</div>
                <div class="card-body action-buttons">
                    <button id="approve-device" class="btn btn-success mb-2">
                        <i class="fa-solid fa-check"></i> Approve Device
                    </button>
                    <button class="btn btn-outline-primary mb-2">
                        <i class="fa-solid fa-rotate"></i> Force Patch
                    </button>
                    <button class="btn btn-outline-danger mb-2">
                        <i class="fa-solid fa-arrow-rotate-left"></i> Force Reinstall
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- JS Dependencies -->
<script src="https://code.jquery.com/jquery-3.7.0.min.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

<script>
document.addEventListener('DOMContentLoaded', async function() {
    const deviceId = window.location.pathname.split('/').pop();

    try {
        const res = await fetch(`/api/devices/${deviceId}`);
        const device = await res.json();

        // Device Info
        document.getElementById('device-name').textContent = device.device_name || 'â€”';
        document.getElementById('os-name').textContent = device.os_name || 'â€”';
        document.getElementById('last-checkin').textContent = device.last_checkin ? new Date(device.last_checkin).toLocaleString() : 'â€”';
        document.getElementById('status').innerHTML = device.online
            ? '<span class="status-online">ðŸŸ¢ Online</span>'
            : '<span class="status-offline">ðŸ”´ Offline</span>';

        // System Info
        document.getElementById('system-info').innerHTML = `
            <p><strong>CPU:</strong> ${device.cpu ?? 'â€”'}%</p>
            <p><strong>Total RAM:</strong> ${(device.ram_total / 1024 / 1024 / 1024).toFixed(2)} GB</p>
            <p><strong>Used RAM:</strong> ${(device.ram_used / 1024 / 1024 / 1024).toFixed(2)} GB</p>
            <p><strong>Disk Health:</strong> ${device.disk_health ?? 'â€”'}</p>
            <p><strong>Total Disk:</strong> ${(device.disk_total / 1024 / 1024 / 1024).toFixed(2)_

